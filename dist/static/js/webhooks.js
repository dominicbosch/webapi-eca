var arrKV,arrParams,fClearInfo,fDisplayError,fFailedRequest,fIssueRequest,fOnLoad,fProcessWebhookList,fShowWebhookUsage,fUpdateWebhookList,hostUrl,i,len,oParams,param;for(arrParams=window.location.search.substring(1).split("&"),oParams={},i=0,len=arrParams.length;len>i;i++)param=arrParams[i],arrKV=param.split("="),oParams[arrKV[0]]=arrKV[1];oParams.id&&(oParams.id=decodeURIComponent(oParams.id)),hostUrl=[location.protocol,"//",location.host].join(""),fClearInfo=function(){return $("#info").text(""),$("#info").attr("class","neutral")},fDisplayError=function(e){return window.scrollTo(0,0),$("#info").text("Error: "+e),$("#info").attr("class","error")},fIssueRequest=function(e){return fClearInfo(),$.post("/usercommand/"+e.command,e.data).done(e.done).fail(e.fail)},fFailedRequest=function(e){return function(o){return 401===o.status?window.location.href="forge?page=forge_rule":fDisplayError(e)}},fUpdateWebhookList=function(e){return fIssueRequest({command:"get_all_webhooks",done:fProcessWebhookList(e),fail:fFailedRequest("Unable to get Webhook list")})},fProcessWebhookList=function(e){return function(o){var t,a,r,n,s,i,l;if($("#table_webhooks *").remove(),o.message){n=JSON.parse(o.message),$("#table_webhooks").append($("<h3>").text("Your existing Webhooks:"));for(t in n)a=n[t],l=$("<tr>"),s=$("<div>").text(a),i=$("<input>").attr("style","width:600px").val(hostUrl+"/webhooks/"+t),r=$("<img>").attr("class","del").attr("title","Delete Module").attr("src","images/red_cross_small.png"),l.append($("<td>").append(r)),l.append($("<td>").attr("style","padding-left:10px").append(s)),l.append($("<td>").attr("style","padding-left:10px").append(i)),$("#table_webhooks").append(l)}else fShowWebhookUsage(null);return"function"==typeof e?e(t,a):void 0}},fShowWebhookUsage=function(e,o){var t,a,r;return $("#display_hookurl *").remove(),e?(t=$("<b>").text("This is the Webhook Url you can use for your Events '"+o+"' : "),$("#display_hookurl").append(t),$("#display_hookurl").append($("<br>")),r=$("<input>").attr("type","text").attr("style","width:600px").val(hostUrl+"/webhooks/"+e),$("#display_hookurl").append(r),$("#display_hookurl").append($("<br>")),a=$("<div>"),a.append($("<br>")),a.append($("<div>").html('1. Try it out and push your location to your new webhook via <a target="_blank" href="'+hostUrl+"/mobile.html?hookid="+e+'">this page</a>.')),a.append($("<br>")),a.append($("<div>").html('2. Then you should setup <a target="_blank" href="forge?page=forge_rule&eventtype=webhook&hookname='+o+"\">a Rule for the '"+o+"' Event!</a>")),$("#display_hookurl").append(a)):void 0},fOnLoad=function(){return document.title="Create Webhooks!",$("#pagetitle").text("Create your own Webhooks!"),fUpdateWebhookList(fShowWebhookUsage),$("#but_submit").click(function(){var e;return fClearInfo(),e=$("#inp_hookname").val(),""===e?fDisplayError("Please provide an Event Name for your new Webhook!"):fIssueRequest({command:"create_webhook",data:{body:JSON.stringify({hookname:e})},done:function(e){var o;return o=JSON.parse(e.message),fShowWebhookUsage(o.hookid,o.hookname),fUpdateWebhookList(function(e){return $("#info").text("New Webhook successfully created!"),$("#info").attr("class","success")})},fail:function(e){return 409===e.status?fFailedRequest("Webhook Event Name already existing!")(e):fFailedRequest("Unable to create Webhook! "+e.message)(e)}})}),$("#table_webhooks").on("click","img",function(){var e,o;return confirm("Do you really want to delete this webhook?")?(o=$("input",$(this).closest("tr")).val(),e=o.split("/"),fIssueRequest({command:"delete_webhook",data:{body:JSON.stringify({hookid:e[e.length-1]})},done:function(e){return fUpdateWebhookList(function(e){return $("#info").text("Webhook deleted!"),$("#info").attr("class","success")})},fail:function(e){return fFailedRequest("Unable to delete Webhook!")(e)}})):void 0})},window.addEventListener("load",fOnLoad,!0);